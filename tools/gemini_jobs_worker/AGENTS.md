Gemini Jobs Worker â€” instructions and safety rules.

Scope
- This worker is isolated from Ask2 and must not modify any Ask2 code paths, services, or env settings.
- Use the existing Oracle connectivity through `tools.oracle.env_bootstrap.load_env_files()` and `db_helper.get_connection()`.

Routine mapping
- "Text to publish news on Sustainacore.org" -> NEWS_PUBLISH
- "Text to be transformed and added to RAG Vectors" -> RAG_INGEST
- "Data to be added to Index Rebalance" -> INDEX_REBALANCE

Supported routine
- RAG_INGEST only.

Safety + idempotency
- Always create an approval before any insertion into ESG_DOCS.
- Insert only after approval status is APPROVED.
- Deterministic `SOURCE_ID` is derived from `job_id + row_key + chunk_ix` to avoid duplicates.
- Before insert, check existing `SOURCE_ID` values and skip duplicates.
- If approval is already applied, do not re-apply.

Schema mapping (RAG_INGEST)
- ESG_DOCS columns:
  - SOURCE_TYPE: from CSV `source_type` or default `rag_ingest`.
  - SOURCE_ID: deterministic string based on job_id + row_key + chunk_ix.
  - SOURCE_URL: from CSV `source_url` or empty.
  - TITLE: from CSV `title` or empty.
  - CHUNK_IX: chunk sequence number (1-based).
  - CHUNK_TEXT: constructed document text, then chunked by size.
  - EMBEDDING: generated by the configured embedding service.

Approval payload format
- CSV with columns:
  - job_id, row_key, source_id, source_type, source_url, title, chunk_ix, chunk_text
- This payload file is attached to PROC_GEMINI_APPROVALS.FILE_BLOB and is used for ingestion after approval.

Approval fields
- REQUEST_TYPE: ADD_VECTORS
- TITLE: short description of the job
- PROPOSED_TEXT: concise summary (row count, chunk count, date range when available)
- DETAILS: full plan, schema mapping, warnings, and comments
- SOURCE_JOB_ID: original job id
- STATUS: PENDING until decided

Error handling
- If required columns are missing, create an approval that requests clarification instead of failing silently.
- If approval is rejected, mark the job as DONE with a rejection note and do not mutate ESG_DOCS.

Learned Notes (append-only)
- None yet.
