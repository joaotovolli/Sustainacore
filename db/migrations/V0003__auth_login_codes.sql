CREATE TABLE SC_AUTH_LOGIN_CODES (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email_normalized VARCHAR2(320) NOT NULL,
    code_hash VARCHAR2(64) NOT NULL,
    salt VARCHAR2(64) NOT NULL,
    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
    used_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT SYSTIMESTAMP NOT NULL,
    request_ip VARCHAR2(64) NOT NULL,
    attempts NUMBER(5) DEFAULT 0 NOT NULL,
    last_attempt_at TIMESTAMP WITH TIME ZONE
);

CREATE INDEX SC_AUTH_LOGIN_CODES_EMAIL_IDX ON SC_AUTH_LOGIN_CODES (email_normalized);
CREATE INDEX SC_AUTH_LOGIN_CODES_EXPIRES_IDX ON SC_AUTH_LOGIN_CODES (expires_at);
