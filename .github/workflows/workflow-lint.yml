name: Workflow Lint

on:
  pull_request:
  push:
    branches: [main]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install actionlint
        run: |
          # Pinned download with checksum verification (no curl|bash).
          ACTIONLINT_VERSION="1.7.10"
          ACTIONLINT_TGZ="actionlint_${ACTIONLINT_VERSION}_linux_amd64.tar.gz"
          ACTIONLINT_URL="https://github.com/rhysd/actionlint/releases/download/v${ACTIONLINT_VERSION}/${ACTIONLINT_TGZ}"
          CHECKSUMS_FILE="actionlint_${ACTIONLINT_VERSION}_checksums.txt"
          CHECKSUMS_URL="https://github.com/rhysd/actionlint/releases/download/v${ACTIONLINT_VERSION}/${CHECKSUMS_FILE}"
          curl -sSLO "${ACTIONLINT_URL}"
          curl -sSLO "${CHECKSUMS_URL}"
          grep " ${ACTIONLINT_TGZ}$" "${CHECKSUMS_FILE}" | sha256sum -c -
          tar -xzf "${ACTIONLINT_TGZ}" actionlint
      - name: Run actionlint
        run: ./actionlint -color -shellcheck=
      - name: Install yamllint
        run: |
          python -m pip install --upgrade pip
          python -m pip install yamllint
      - name: Run yamllint on workflows
        run: |
          python -m yamllint -d "{extends: default, rules: {line-length: disable, truthy: disable}}" .github/workflows
