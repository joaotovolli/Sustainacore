name: CI

on:
  pull_request:
  workflow_dispatch:

jobs:
  guard-secrets:
    name: Ensure sensitive files are ignored
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Verify that sensitive files are not committed
        run: |
          set -euo pipefail
          files=$(git ls-files -- ':**/.env' ':**/wallet/**')
          if [ -n "$files" ]; then
            echo "The following sensitive files are committed:" >&2
            echo "$files" >&2
            exit 1
          fi
          echo "No tracked .env or wallet files detected."

  persona-guard:
    name: Persona guard (manual eval lives in persona-eval)
    runs-on: ubuntu-latest
    steps:
      - name: Provide guidance
        env:
          EVAL_BASE_URL: ${{ secrets.EVAL_BASE_URL }}
        run: |
          {
            echo "## Persona guard";
            echo "Full persona evaluation runs only via the **Persona eval** workflow (manual dispatch).";
            if [ -n "${EVAL_BASE_URL}" ]; then
              echo "- Secret \`EVAL_BASE_URL\` is configured; the manual persona eval can run when needed.";
            else
              echo "- Secret \`EVAL_BASE_URL\` is not configured; set it to enable manual persona eval runs.";
            fi
            echo;
            echo "Use **Actions → Persona eval → Run workflow** to execute the full evaluation when you need persona coverage.";
          } >> "$GITHUB_STEP_SUMMARY"
