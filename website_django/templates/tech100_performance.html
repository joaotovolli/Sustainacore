{% extends "base.html" %}
{% load static %}

{% block title %}Tech100 AI Ethics &amp; Governance Index | Performance{% endblock %}
{% block meta_description %}Analyze Tech100 AI Ethics &amp; Governance Index performance, drawdowns, volatility, and attribution across recent rebalance periods.{% endblock %}

{% block extra_head %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
{% endblock %}

{% block content %}
<div class="tech100-index">
  <section class="section section--with-header sc-section sc-section--with-header">
    <div class="shell sc-container">
      <div class="section__header section__header--split sc-page-header sc-page-header--split">
        <div>
          <span class="pill pill--soft">Tech100 AI Ethics &amp; Gov Index</span>
          <h1>Performance</h1>
          <p class="muted">Levels, drawdowns, volatility, and attribution.</p>
          <p class="disclaimer-banner">
            <a class="text-link" href="/tech100/methodology/">Methodology &amp; Limitations</a>
            <span class="disclaimer-banner__corrections"> · <a class="text-link" href="/corrections/">Corrections &amp; Complaints</a></span>
            · Research only. Not investment advice. Not affiliated with any company, exchange, or index provider.
          </p>
        </div>
        <div class="meta-stack">
          <div class="meta-pill">Rebalance: <span data-date-format="as-of" data-date-value="{{ rebalance_date }}">{{ rebalance_date|default:"—" }}</span></div>
          <div class="meta-pill">Universe date: <span data-date-format="as-of" data-date-value="{{ universe_date }}">{{ universe_date|default:"—" }}</span></div>
        </div>
      </div>

      {% include "partials/tech100_nav.html" %}

      {% if data_error %}
        <div class="alert alert--warning" data-tech100-empty-state="1">
          Live Tech100 AI Ethics &amp; Governance Index data is temporarily unavailable; please try again later.
        </div>
      {% else %}
        <div id="tech100-performance-status"
             data-tech100-performance-has-data="1"
             data-level-count="{{ levels_count }}"
             data-holdings-count="{{ holdings_count }}"
             data-attribution-count="{{ attribution_count }}"></div>

        <div class="card sc-card tech100-performance__overview" id="overview">
          <div class="tech100-performance__header sc-card__header">
            <div class="sc-card__title">
              <h2 class="h4">Overview</h2>
              <p class="muted">As of <span data-date-format="as-of" data-date-value="{{ latest_date }}">{{ latest_date }}</span> (UTC)</p>
            </div>
            <div class="tech100-index__range sc-segmented">
              <button class="btn btn--ghost tech100-range-btn sc-segmented__btn {% if range_key == '1m' %}is-active{% endif %}" data-range="1m">1M</button>
              <button class="btn btn--ghost tech100-range-btn sc-segmented__btn {% if range_key == '3m' %}is-active{% endif %}" data-range="3m">3M</button>
              <button class="btn btn--ghost tech100-range-btn sc-segmented__btn {% if range_key == '6m' %}is-active{% endif %}" data-range="6m">6M</button>
              <button class="btn btn--ghost tech100-range-btn sc-segmented__btn {% if range_key == 'ytd' %}is-active{% endif %}" data-range="ytd">YTD</button>
              <button class="btn btn--ghost tech100-range-btn sc-segmented__btn {% if range_key == '1y' %}is-active{% endif %}" data-range="1y">1Y</button>
              <button class="btn btn--ghost tech100-range-btn sc-segmented__btn {% if range_key == 'max' %}is-active{% endif %}" data-range="max">Max</button>
            </div>
          </div>
          <div class="tech100-performance__charts">
            <div class="chart-card sc-card">
              <h3 class="h5">Index level</h3>
              <div class="chart-card__canvas">
                <canvas id="tech100-performance-level-chart" role="img" aria-label="Tech100 index level chart"></canvas>
              </div>
            </div>
            <div class="chart-card sc-card">
              <h3 class="h5">Drawdown</h3>
              <div class="chart-card__canvas">
                <canvas id="tech100-performance-drawdown-chart" role="img" aria-label="Tech100 drawdown chart"></canvas>
              </div>
            </div>
            <div class="chart-card sc-card">
              <h3 class="h5">Rolling 30D volatility</h3>
              <div class="chart-card__canvas">
                <canvas id="tech100-performance-vol-chart" role="img" aria-label="Tech100 rolling volatility chart"></canvas>
              </div>
            </div>
          </div>

          <div class="tech100-performance__summary">
            <div class="kpi-card sc-metric-card">
              <span class="kpi-label">Latest level</span>
              <span class="kpi-value">{{ kpis.level|floatformat:2 }}</span>
            </div>
            <div class="kpi-card sc-metric-card">
              <span class="kpi-label">1D return</span>
              <span class="kpi-value">
                {% if kpis.ret_1d or kpis.ret_1d == 0 %}
                  {{ kpis.ret_1d|floatformat:2 }}%
                {% else %}
                  —
                {% endif %}
              </span>
            </div>
            <div class="kpi-card sc-metric-card">
              <span class="kpi-label">MTD return</span>
              <span class="kpi-value">
                {% if kpis.ret_mtd or kpis.ret_mtd == 0 %}
                  {{ kpis.ret_mtd|floatformat:2 }}%
                {% else %}
                  —
                {% endif %}
              </span>
            </div>
            <div class="kpi-card sc-metric-card">
              <span class="kpi-label">YTD Return</span>
              <span class="kpi-value">
                {% if kpis.ret_ytd or kpis.ret_ytd == 0 %}
                  {{ kpis.ret_ytd|floatformat:2 }}%
                {% else %}
                  —
                {% endif %}
              </span>
            </div>
            <div class="kpi-card sc-metric-card">
              <span class="kpi-label">30D vol (ann.)</span>
              <span class="kpi-value">
                {% if kpis.vol_30d or kpis.vol_30d == 0 %}
                  {{ kpis.vol_30d|floatformat:2 }}%
                {% else %}
                  —
                {% endif %}
              </span>
            </div>
            <div class="kpi-card sc-metric-card">
              <span class="kpi-label">Max drawdown YTD</span>
              <span class="kpi-value">
                {% if kpis.drawdown_ytd or kpis.drawdown_ytd == 0 %}
                  {{ kpis.drawdown_ytd|floatformat:2 }}%
                {% else %}
                  —
                {% endif %}
              </span>
            </div>
          </div>
        </div>

        <div class="card sc-card tech100-performance__attribution" id="attribution">
          <div class="card__header card__header--split sc-card__header">
            <div class="sc-card__title">
              <h2 class="h4">Attribution</h2>
              <p class="muted">Top and bottom contributors by range.</p>
            </div>
            <div class="card__actions sc-card__controls">
              <div class="tech100-performance__range sc-segmented">
                <button class="btn btn--ghost tech100-attr-range sc-segmented__btn is-active" data-range="1d">1D</button>
                <button class="btn btn--ghost tech100-attr-range sc-segmented__btn" data-range="mtd">MTD</button>
                <button class="btn btn--ghost tech100-attr-range sc-segmented__btn" data-range="ytd">YTD</button>
              </div>
              <a class="btn btn--ghost btn--sm" href="/tech100/performance/export/?kind=attribution">Download CSV</a>
            </div>
          </div>
          <div id="tech100-attribution-status" data-tech100-attribution-has-data="1"></div>
          <div class="tech100-performance__bars">
            <div>
              <h3 class="h5">Top contributors</h3>
              <canvas id="tech100-top-contrib-chart" role="img" aria-label="Top contributors"></canvas>
            </div>
            <div>
              <h3 class="h5">Worst contributors</h3>
              <canvas id="tech100-worst-contrib-chart" role="img" aria-label="Worst contributors"></canvas>
            </div>
          </div>
          <div class="tech100-performance__filters">
            <input type="search" id="tech100-attr-search" placeholder="Search ticker or company">
            <select id="tech100-attr-sector">
              <option value="">All sectors</option>
            </select>
          </div>
          <div class="table-wrapper table-wrap sc-table-wrap">
            <table class="table table--wide tech100-table sc-table" aria-label="Tech100 attribution">
              <thead>
                <tr>
                  <th class="text-left">Ticker</th>
                  <th class="text-left">Name</th>
                  <th class="text-right">Weight (%)</th>
                  <th class="text-right">1D Return (%)</th>
                  <th class="text-right">1D Contrib (bp)</th>
                  <th class="text-right">MTD Contrib (bp)</th>
                  <th class="text-right">YTD Contrib (bp)</th>
                </tr>
              </thead>
              <tbody id="tech100-attr-body"></tbody>
            </table>
          </div>
        </div>

        <div class="card sc-card tech100-performance__holdings" id="holdings">
          <div class="card__header card__header--split sc-card__header">
            <div class="sc-card__title">
              <h2 class="h4">Constituents &amp; Holdings</h2>
              <p class="muted">Latest holdings from the index universe.</p>
            </div>
            <div class="card__actions sc-card__controls">
              <a class="btn btn--ghost btn--sm" href="/tech100/performance/export/?kind=holdings">Download CSV</a>
            </div>
          </div>
          <div id="tech100-holdings-status" data-tech100-holdings-has-data="1"></div>
          <div class="tech100-performance__holdings-grid">
            <div class="chart-card sc-card">
              <h3 class="h5">Sector weights</h3>
              <canvas id="tech100-sector-chart" role="img" aria-label="Sector breakdown"></canvas>
            </div>
          </div>
          <div class="table-wrapper table-wrap sc-table-wrap">
            <table class="table table--wide tech100-table sc-table" aria-label="Tech100 holdings">
              <thead>
                <tr>
                  <th class="text-left">Ticker</th>
                  <th class="text-left">Name</th>
                  <th class="text-left">Sector</th>
                  <th class="text-right">Weight (%)</th>
                  <th class="text-right">1D Return (%)</th>
                  <th class="text-right">1D Contrib (bp)</th>
                </tr>
              </thead>
              <tbody id="tech100-holdings-body"></tbody>
            </table>
          </div>
        </div>
      {% endif %}
    </div>
  </section>
</div>

{{ levels_payload|json_script:"tech100-performance-levels" }}
{{ drawdown_payload|json_script:"tech100-performance-drawdown" }}
{{ vol_payload|json_script:"tech100-performance-vol" }}
{{ holdings|json_script:"tech100-performance-holdings" }}
{{ sector_breakdown|json_script:"tech100-performance-sectors" }}
{{ attribution_rows|json_script:"tech100-performance-attribution" }}
{{ top_1d|json_script:"tech100-performance-top-1d" }}
{{ worst_1d|json_script:"tech100-performance-worst-1d" }}
{{ top_mtd|json_script:"tech100-performance-top-mtd" }}
{{ worst_mtd|json_script:"tech100-performance-worst-mtd" }}
{{ top_ytd|json_script:"tech100-performance-top-ytd" }}
{{ worst_ytd|json_script:"tech100-performance-worst-ytd" }}
{% endblock %}

{% block extra_scripts %}
  <script src="{% static 'js/date-format.js' %}?v=20251221" defer></script>
  <script src="{% static 'js/tech100-index.js' %}?v=20260123-3" defer></script>
{% endblock %}
