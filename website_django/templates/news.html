{% extends "base.html" %}
{% load static %}

{% block title %}News | SustainaCore ESG & AI Governance{% endblock %}
{% block meta_description %}Curated headlines on ESG transparency and AI governance, highlighting regulatory moves and accountability signals across the TECH100 cohort.{% endblock %}
{% block structured_data %}
    {% if news_json_ld %}
    <script type="application/ld+json">{{ news_json_ld|safe }}</script>
    {% endif %}
{% endblock %}

{% block content %}
<section class="section section--with-header">
    <div class="shell">
        <div class="section__header section__header--split">
            <div>
                <p class="eyebrow">News &amp; Insights</p>
                <h1>Headlines on ESG transparency and AI governance.</h1>
                <p class="muted">Curated stories that surface transparency updates, regulatory moves, and accountability signals across the TECH100 cohort.</p>
            </div>
            <div class="filters">
                <form class="filters" method="get">
                    <label>
                        Source
                        <select name="source">
                            <option value="" {% if not filters.source %}selected{% endif %}>All sources</option>
                            {% for source in source_options %}
                            <option value="{{ source }}" {% if filters.source == source %}selected{% endif %}>{{ source }}</option>
                            {% endfor %}
                        </select>
                    </label>
                    <label>
                        Tag
                        <select name="tag">
                            <option value="" {% if not filters.tag %}selected{% endif %}>All tags</option>
                            {% for tag in tag_options %}
                            <option value="{{ tag }}" {% if filters.tag == tag %}selected{% endif %}>{{ tag }}</option>
                            {% endfor %}
                        </select>
                    </label>
                    <label>
                        Date range
                        <select name="date_range">
                            {% for option in date_range_options %}
                            <option value="{{ option.value }}" {% if filters.date_range == option.value %}selected{% endif %}>{{ option.label }}</option>
                            {% endfor %}
                        </select>
                    </label>
                    <div class="filters__actions">
                        <button class="btn btn--secondary" type="submit">Apply</button>
                    </div>
                </form>
            </div>
        </div>
        {% if news_error %}
        <div class="alert alert--warning">
            News is temporarily unavailable. Please try again in a moment.
        </div>
        {% endif %}
        <div class="cards cards--list" data-news-list>
            {% if news_error %}
            <article class="news-card">
                <p class="muted">News is temporarily unavailable. Please try again in a moment.</p>
            </article>
            {% elif articles %}
                {% for article in articles %}
                <article class="news-card">
                    <div class="news-card__meta">
                        {{ article.source }}{% if article.published_at %} · {{ article.published_at|date:"M j, Y" }}{% endif %}
                    </div>
                    <h3 class="news-card__title">
                        <a href="{{ article.url }}" target="_blank" rel="noreferrer">{{ article.title }}</a>
                    </h3>
                    <p class="muted">{{ article.summary|default_if_none:""|truncatechars:320 }}</p>
                    {% if article.tags or article.categories or article.pillar_tags %}
                    <div class="news-card__tags">
                        {% if article.tags %}
                            {% for tag in article.tags %}
                            <span class="tag">{{ tag }}</span>
                            {% endfor %}
                        {% endif %}
                        {% if article.categories %}
                            {% for category in article.categories %}
                            <span class="tag tag--muted">{{ category }}</span>
                            {% endfor %}
                        {% endif %}
                        {% if article.pillar_tags %}
                            {% for pillar_tag in article.pillar_tags %}
                            <span class="tag tag--muted">{{ pillar_tag }}</span>
                            {% endfor %}
                        {% endif %}
                    </div>
                    {% endif %}
                    <a class="text-link" href="{{ article.url }}" target="_blank" rel="noreferrer">View source →</a>
                </article>
                {% endfor %}
            {% else %}
                <article class="news-card">
                    <p class="muted">No results for this filter or date range.</p>
                </article>
            {% endif %}
        </div>
        {% if news_meta.has_more %}
        <div class="load-more">
            <button class="btn btn--secondary" type="button" disabled>Load more (live API coming soon)</button>
            <p class="muted">
                Showing {{ news_meta.count|default:articles|length }} of recent stories.
            </p>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
    <script src="{% static 'js/news.js' %}"></script>
{% endblock %}
