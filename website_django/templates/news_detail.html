{% extends "base.html" %}
{% load static %}

{% block title %}{% if article %}{{ article.title }}{% else %}News | SustainaCore ESG & AI Governance{% endif %}{% endblock %}
{% block meta_description %}{% if article %}{{ article.summary|default_if_none:""|truncatechars:160 }}{% else %}Curated headlines on ESG transparency and AI governance.{% endif %}{% endblock %}
{% block og_title %}{% if article %}{{ article.title }}{% else %}News | SustainaCore{% endif %}{% endblock %}
{% block og_description %}{% if article %}{{ article.summary|default_if_none:""|truncatechars:160 }}{% else %}Curated headlines on ESG transparency and AI governance.{% endif %}{% endblock %}
{% block structured_data %}
    {% if article %}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "NewsArticle",
      "headline": "{{ article.title|escapejs }}",
      "datePublished": "{% if published_at %}{{ published_at|date:'Y-m-d' }}{% elif article.published_at %}{{ article.published_at }}{% endif %}",
      "dateModified": "{% if published_at %}{{ published_at|date:'Y-m-d' }}{% elif article.published_at %}{{ article.published_at }}{% endif %}",
      "description": "{{ article.summary|default_if_none:''|truncatechars:160|escapejs }}",
      "url": "{{ canonical_url }}",
      "mainEntityOfPage": "{{ canonical_url }}",
      "author": {
        "@type": "Organization",
        "name": "SustainaCore"
      },
      "publisher": {
        "@type": "Organization",
        "name": "SustainaCore",
        "url": "{{ site_url }}",
        "logo": {
          "@type": "ImageObject",
          "url": "{{ site_url }}/static/img/sustainacore_logo_512.png",
          "width": 512,
          "height": 512
        }
      }
    }
    </script>
    {% endif %}
{% endblock %}

{% block content %}
<section class="section news-detail">
    <div class="shell">
        <a class="text-link news-detail__back" href="{{ back_url }}">← Back to news</a>
        {% if news_error %}
        <div class="alert alert--warning">
            {{ news_error }}
        </div>
        {% endif %}
        {% if article %}
        <div class="news-detail__grid" data-news-detail>
            <div class="news-detail__main">
                <div class="news-detail__meta">
                    {{ article.source|default:"SustainaCore" }}
                    {% if published_at %} · {{ published_at|date:"M j, Y · H:i" }}{% elif article.published_at %} · {{ article.published_at }}{% endif %}
                    {% if external_url %}
                        · <a class="text-link" href="{{ external_url }}" target="_blank" rel="noopener noreferrer">Read at source</a>
                    {% endif %}
                </div>
                <h1 data-news-title>{{ article.title }}</h1>
                {% if tickers or tags or categories or pillar_tags %}
                <div class="news-detail__tags">
                    {% if tickers %}
                        {% for ticker in tickers %}
                        <span class="tag tag--brand">{{ ticker }}</span>
                        {% endfor %}
                    {% endif %}
                    {% if tags %}
                        {% for tag in tags %}
                        <span class="tag">{{ tag }}</span>
                        {% endfor %}
                    {% endif %}
                    {% if categories %}
                        {% for category in categories %}
                        <span class="tag tag--muted">{{ category }}</span>
                        {% endfor %}
                    {% endif %}
                    {% if pillar_tags %}
                        {% for pillar_tag in pillar_tags %}
                        <span class="tag tag--muted">{{ pillar_tag }}</span>
                        {% endfor %}
                    {% endif %}
                </div>
                {% endif %}
                {% if body_html %}
                <div class="news-detail__body">
                    {% if body_is_fallback %}
                    <p class="muted">Full text is not available for this story. Showing the available summary instead.</p>
                    {% endif %}
                    <div class="news-detail__rich">{{ body_html|safe }}</div>
                </div>
                {% elif body_paragraphs %}
                <div class="news-detail__body">
                    {% if body_is_fallback %}
                    <p class="muted">Full text is not available for this story. Showing the available summary instead.</p>
                    {% endif %}
                    {% for paragraph in body_paragraphs %}
                    <p>{{ paragraph }}</p>
                    {% endfor %}
                </div>
                {% else %}
                <div class="news-detail__body">
                    <p class="muted">Full text is not available for this story.</p>
                </div>
                {% endif %}
                {% if debug %}
                <!-- news_debug id={{ article.id }} field={{ body_source }} len={{ body_length }} -->
                {% endif %}
            </div>
        </div>
        {% else %}
        <div class="news-detail__empty" data-news-empty-state>
            <h2>Story unavailable</h2>
            <p class="muted">We could not find this story. Try browsing the latest headlines.</p>
            <a class="btn btn--secondary" href="{% url 'news' %}">Return to news</a>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
